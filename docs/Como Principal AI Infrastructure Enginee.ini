Como Principal AI Infrastructure Engineer, aquí tienes la configuración técnica optimizada para integrar SmartSeller con Codex CLI y habilitar el control total de la base de datos Supabase.

1. Preparación de Credenciales
Necesitarás un Personal Access Token (PAT) de Supabase. Consíguelo en: https://supabase.com/dashboard/account/tokens.

2. Configuración de Codex CLI (~/.codex/config.toml)
Ejecuta estos comandos en tu terminal (WSL) para crear la configuración necesaria. He optimizado los modelos para razonamiento SQL complejo.

bash
# 1. Asegurar la existencia del directorio
mkdir -p ~/.codex
# 2. Crear/Sobreescribir el archivo config.toml con el servidor MCP de Supabase
cat > ~/.codex/config.toml <<EOF
[models]
default = "o1-preview" # Optimizado para SQL
model_reasoning_effort = "high"
[mcp_servers.supabase]
command = "npx"
args = ["-y", "@modelcontextprotocol/server-supabase"]
env = { SUPABASE_ACCESS_TOKEN = "TU_TOKEN_AQUÍ", SUPABASE_PROJECT_ID = "amygbmnjjwtnyjclghok" }
EOF
Nota: Reemplaza TU_TOKEN_AQUÍ por tu PAT de Supabase.

3. Instalación y Verificación Local
El servidor MCP se instalará automáticamente vía npx en la primera ejecución, pero puedes forzar la validación de conectividad así:

bash
# Validar que Codex CLI carga los módulos correctamente
codex --list-tools | grep supabase
# Verificación de conectividad real (Safe to run)
codex --query "Listar todas las tablas en el esquema public en Supabase"
4. Flujo Alternativo: Supabase CLI (Fallback de Alto Rendimiento)
Dado que ya detecté Supabase CLI v2.67.1 instalado, puedes usar este flujo si prefieres evitar la abstracción MCP o para tareas de DDL masivo.

Comando de Configuración (Una sola vez):

bash
# Login local
supabase login
# Vincular proyecto
supabase link --project-ref amygbmnjjwtnyjclghok
Comandos que Codex puede ejecutar directamente: Codex es capaz de usar el comando supabase db query si el servidor MCP llegara a fallar:

bash
# Ejemplo de query directo que Codex puede orquestar:
supabase db query "SELECT count(*) FROM clinical_events;"
5. Comando de Oro: Verificación de Integración Final
Una vez configurado el config.toml, ejecuta este comando dentro de Codex CLI para confirmar que la "Fuente de la Verdad" es accesible:

sql
-- Ejecuta esto pidiéndoselo a Codex CLI:
"Ejecuta un query SQL para listar las tablas del esquema public y el número de filas de cada una"
6. Beneficios de esta Configuración Enterprise
Auditabilidad: Todas las ejecuciones quedan registradas en el historial de Codex.
Seguridad: El token PAT permite a Codex ver el Management API (logs, advisors) y no solo datos crudos.
Reasoning: Usar model_reasoning_effort = "high" asegura que Codex analice las dependencias de las Foreign Keys antes de sugerir una migración.
